{"version":3,"file":"helpers.js","sourceRoot":"","sources":["helpers.ts"],"names":[],"mappings":";;;AAAA,mCAAmC;AACnC,oCAAoC;AAGpC,kBAA+B,IAAS,EAAE,UAAmB,EAAE,KAAa;;QAC3E,MAAM,OAAO,GAAG,IAAI,OAAO,CAAC,CAAO,OAAO,EAAE,EAAE;YAC7C,MAAM,IAAI,CAAC,QAAQ,CAClB,CAAC,KAAa,EAAE,UAAmB,EAAE,EAAE;gBACtC,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;oBAChB,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,EAAE,CAAC;oBAC/C,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC;oBACxC,MAAM,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC;gBAC7C,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,KAAK,CAAC;gBAC9B,CAAC;YACF,CAAC,EACD,KAAK,EACL,UAAU,CACV,CAAC;YACF,UAAU,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QAC1B,CAAC,CAAA,CAAC,CAAC;QACH,MAAM,CAAC,OAAO,CAAC;IAChB,CAAC;CAAA;AAlBD,4BAkBC;AAOD,eAA4B,SAAiB;;QAC5C,MAAM,GAAG,GAAG,OAAO,EAAE,CAAC;QACtB,MAAM,IAAI,GAAG,MAAM,OAAO,EAAE,CAAC;QAC7B,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;QACnC,MAAM,OAAO,GAAG,IAAI,OAAO,CAAe,CAAC,OAAO,EAAE,EAAE;YACrD,MAAM,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,EAAE;gBACpC,OAAO,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;YAC3B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QACH,MAAM,CAAC,OAAO,CAAC;IAChB,CAAC;CAAA;AAVD,sBAUC;AAED,oBAAiC,IAAS;;QACzC,MAAM,CAAC,MAAM,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE;YAC/B,aAAa;YACb,MAAM,YAAY,GAAG,MAAM,CAAC,UAAU,CAAC,YAAY,CAAC;YACpD,MAAM,UAAU,GAAG,QAAQ,CAAC,gBAAgB,CAAC,QAAQ,CAAC,IAAI,EAAE,YAAY,CAAC,CAAC;YAC1E,IAAI,OAAO,GAAa,EAAE,CAAC;YAE3B,OAAO,UAAU,CAAC,QAAQ,EAAE,EAAE,CAAC;gBAC9B,MAAM,IAAI,GAAG,UAAU,CAAC,WAA0B,CAAC;gBACnD,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YACtE,CAAC;YAED,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC,SAAS,EAAE,EAAE,CAAC,IAAI,SAAS,EAAE,CAAC,CAAC;YACtD,MAAM,CAAC,OAAO,CAAC;QAChB,CAAC,CAAC,CAAC;IACJ,CAAC;CAAA;AAfD,gCAeC;AAED,qBAAkC,IAAS;;QAC1C,MAAM,IAAI,CAAC,qBAAqB,CAAC,GAAG,EAAE;YACrC,aAAa;YACb,MAAM,CAAC,kBAAkB,GAAG,EAAE,cAAc,EAAE,EAAE,mBAAmB,EAAE,IAAI,EAAE,EAAE,CAAC;YAC9E,aAAa;YACb,MAAM,CAAC,eAAe,GAAG,GAAG,CAAC;QAC9B,CAAC,CAAC,CAAC;IACJ,CAAC;CAAA;AAPD,kCAOC;AAED,wBAAqC,IAAS,EAAE,QAAgB;;QAC/D,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,OAAgB,EAAE,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;IACtE,CAAC;CAAA;AAFD,wCAEC;AAED,sCAA6C,IAAc,EAAE,KAAY,EAAE,IAAY;IACtF,MAAM,CAAC;;eAEO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;cACtB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;0CACQ,IAAI;;;;;;;;;;;;;;UAcpC,CAAC;AACX,CAAC;AApBD,oEAoBC;AAED,0BAAiC,KAAK,GAAG,cAAc;IACtD,MAAM,CAAC;4DACoD,IAAI,MAAM,CAAC,GAAG,KAAK,OAAO,CAAC;UAC7E,CAAC;AACX,CAAC;AAJD,4CAIC;AAED,mBAA0B,IAAa;IACtC,MAAM,CAAC,IAAI;QACV,CAAC,CAAC,GAAG,IAAI;aACN,KAAK,CAAC,GAAG,CAAC;aACV,GAAG,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC;aACf,IAAI,CAAC,GAAG,CAAC,GAAG;QACf,CAAC,CAAC,EAAE,CAAC;AACP,CAAC;AAPD,8BAOC","sourcesContent":["import * as express from 'express';\nimport * as getPort from 'get-port';\nimport * as http from 'http';\n\nexport async function navigate(page: any, useHistory: boolean, route: string) {\n\tconst promise = new Promise(async (resolve) => {\n\t\tawait page.evaluate(\n\t\t\t(route: string, useHistory: boolean) => {\n\t\t\t\tif (useHistory) {\n\t\t\t\t\troute = route[0] === '/' ? route : `/${route}`;\n\t\t\t\t\twindow.history.pushState({}, '', route);\n\t\t\t\t\twindow.dispatchEvent(new Event('popstate'));\n\t\t\t\t} else {\n\t\t\t\t\twindow.location.hash = route;\n\t\t\t\t}\n\t\t\t},\n\t\t\troute,\n\t\t\tuseHistory\n\t\t);\n\t\tsetTimeout(resolve, 500);\n\t});\n\treturn promise;\n}\n\nexport interface ServeDetails {\n\tserver: http.Server;\n\tport: number;\n}\n\nexport async function serve(directory: string): Promise<ServeDetails> {\n\tconst app = express();\n\tconst port = await getPort();\n\tapp.use(express.static(directory));\n\tconst promise = new Promise<ServeDetails>((resolve) => {\n\t\tconst server = app.listen(port, () => {\n\t\t\tresolve({ server, port });\n\t\t});\n\t});\n\treturn promise;\n}\n\nexport async function getClasses(page: any): Promise<String[]> {\n\treturn await page.evaluate(() => {\n\t\t// @ts-ignore\n\t\tconst SHOW_ELEMENT = window.NodeFilter.SHOW_ELEMENT;\n\t\tconst treeWalker = document.createTreeWalker(document.body, SHOW_ELEMENT);\n\t\tlet classes: string[] = [];\n\n\t\twhile (treeWalker.nextNode()) {\n\t\t\tconst node = treeWalker.currentNode as HTMLElement;\n\t\t\tnode.classList.length && classes.push.apply(classes, node.classList);\n\t\t}\n\n\t\tclasses = classes.map((className) => `.${className}`);\n\t\treturn classes;\n\t});\n}\n\nexport async function setHasFlags(page: any): Promise<void> {\n\tawait page.evaluateOnNewDocument(() => {\n\t\t// @ts-ignore\n\t\twindow.DojoHasEnvironment = { staticFeatures: { 'build-time-render': true } };\n\t\t// @ts-ignore\n\t\twindow.__public_path__ = '/';\n\t});\n}\n\nexport async function getForSelector(page: any, selector: string) {\n\treturn page.$eval(selector, (element: Element) => element.outerHTML);\n}\n\nexport function generateRouteInjectionScript(html: string[], paths: any[], root: string): string {\n\treturn `<script>\n(function () {\n\tvar paths = ${JSON.stringify(paths)};\n\tvar html = ${JSON.stringify(html)};\n\tvar element = document.getElementById('${root}');\n\tvar target;\n\tpaths.some(function (path, i) {\n\t\tvar match = (typeof path === 'string' && path === window.location.hash) || path && (typeof path === 'object' && path.match && new RegExp(path.match.join('|')).test(window.location.hash));\n\t\tif (match) {\n\t\t\ttarget = html[i];\n\t\t}\n\t\treturn match;\n\t});\n\tif (target && element) {\n\t\tvar frag = document.createRange().createContextualFragment(target);\n\t\telement.parentNode.replaceChild(frag, element);\n\t}\n}())\n</script>`;\n}\n\nexport function generateBasePath(route = '__app_root__') {\n\treturn `<script>\nwindow.__public_path__ = window.location.pathname.replace(${new RegExp(`${route}(\\/)?`)}, '');\n</script>`;\n}\n\nexport function getPrefix(path?: string) {\n\treturn path\n\t\t? `${path\n\t\t\t\t.split('/')\n\t\t\t\t.map(() => '..')\n\t\t\t\t.join('/')}/`\n\t\t: '';\n}\n"]}