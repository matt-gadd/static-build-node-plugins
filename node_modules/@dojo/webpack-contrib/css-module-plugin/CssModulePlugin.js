"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const path_1 = require("path");
const webpack_1 = require("webpack");
/**
 * Test whether a module ID is relative or absolute.
 *
 * @param id
 * The module ID.
 *
 * @return
 * `true` if the path is relative; `false` otherwise.
 */
function isRelative(id) {
    const first = path_1.normalize(id.charAt(0));
    return first !== path_1.sep && first !== '@' && /^\W/.test(id);
}
class CssModulePlugin {
    constructor(basePath) {
        this.basePath = basePath;
    }
    apply(compiler) {
        const nmrPlugin = new webpack_1.NormalModuleReplacementPlugin(/\.m\.css$/, (result) => {
            if (path_1.isAbsolute(result.request)) {
                return;
            }
            const requestFileName = isRelative(result.request)
                ? path_1.resolve(result.context, result.request)
                : path_1.resolve(this.basePath, 'node_modules', result.request);
            const jsFileName = requestFileName + '.js';
            if (fs_1.existsSync(jsFileName)) {
                result.request = result.request.replace(/\.m\.css$/, '.m.css.js');
            }
        });
        nmrPlugin.apply(compiler);
    }
}
exports.default = CssModulePlugin;
//# sourceMappingURL=CssModulePlugin.js.map