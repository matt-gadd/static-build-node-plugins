{"version":3,"file":"dev.config.js","sourceRoot":"","sources":["../../../src/dev.config.ts"],"names":[],"mappings":"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","sourcesContent":["import baseConfigFactory, { mainEntry, packageName } from './base.config';\nimport { WebAppManifest } from './interfaces';\nimport * as HtmlWebpackPlugin from 'html-webpack-plugin';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport webpack = require('webpack');\nimport BuildTimeRender from '@dojo/webpack-contrib/build-time-render/BuildTimeRender';\nimport ServiceWorkerPlugin, {\n\tServiceWorkerOptions\n} from '@dojo/webpack-contrib/service-worker-plugin/ServiceWorkerPlugin';\nimport * as CleanWebpackPlugin from 'clean-webpack-plugin';\nimport * as CopyWebpackPlugin from 'copy-webpack-plugin';\nimport * as ManifestPlugin from 'webpack-manifest-plugin';\n\nconst WebpackPwaManifest = require('webpack-pwa-manifest');\n\nfunction webpackConfig(args: any): webpack.Configuration {\n\tconst config = baseConfigFactory(args);\n\tconst manifest: WebAppManifest = args.pwa && args.pwa.manifest;\n\tconst serviceWorker: string | ServiceWorkerOptions = args.pwa && args.pwa.serviceWorker;\n\tconst { plugins, output, module } = config;\n\tconst outputPath = path.join(output!.path!, 'dev');\n\tconst assetsDir = path.join(process.cwd(), 'assets');\n\tconst assetsDirExists = fs.existsSync(assetsDir);\n\n\tif (!args.singleBundle) {\n\t\tconfig.optimization = {\n\t\t\t...config.optimization,\n\t\t\truntimeChunk: { name: 'runtime' }\n\t\t};\n\t}\n\n\tconfig.plugins = [\n\t\t...plugins!,\n\t\tassetsDirExists && new CopyWebpackPlugin([{ from: assetsDir, to: path.join(outputPath, 'assets') }]),\n\t\tnew ManifestPlugin(),\n\t\tnew HtmlWebpackPlugin({\n\t\t\tinject: true,\n\t\t\tchunks: args.singleBundle ? ['main'] : ['runtime', 'main'],\n\t\t\tmeta: manifest ? { 'mobile-web-app-capable': 'yes' } : {},\n\t\t\ttemplate: 'src/index.html'\n\t\t}),\n\t\tmanifest &&\n\t\t\tnew WebpackPwaManifest({\n\t\t\t\t...manifest,\n\t\t\t\tios: true,\n\t\t\t\ticons: Array.isArray(manifest.icons)\n\t\t\t\t\t? manifest.icons.map((icon) => ({ ...icon, ios: true }))\n\t\t\t\t\t: manifest.icons\n\t\t\t}),\n\t\tnew CleanWebpackPlugin(['dev'], { root: output!.path, verbose: false })\n\t].filter((item) => item);\n\n\tif (module) {\n\t\tmodule.rules = module.rules.map((rule) => {\n\t\t\tif (Array.isArray(rule.use)) {\n\t\t\t\trule.use = rule.use.map((loader) => {\n\t\t\t\t\tif (typeof loader === 'string') {\n\t\t\t\t\t\treturn loader;\n\t\t\t\t\t}\n\t\t\t\t\tconst { loader: loaderName, options } = loader as webpack.RuleSetLoader;\n\t\t\t\t\tif (loaderName === '@dojo/webpack-contrib/static-build-loader') {\n\t\t\t\t\t\tif (typeof options === 'object') {\n\t\t\t\t\t\t\toptions.features = { ...(options.features || {}), 'dojo-debug': true };\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tloader: loaderName,\n\t\t\t\t\t\t\toptions\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn loader;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn rule;\n\t\t});\n\t}\n\n\tif (serviceWorker) {\n\t\tconst serviceWorkerOptions =\n\t\t\ttypeof serviceWorker === 'string' ? serviceWorker : { cachePrefix: packageName, ...serviceWorker };\n\t\tconfig.plugins.push(new ServiceWorkerPlugin(serviceWorkerOptions));\n\n\t\tif (typeof serviceWorker !== 'string') {\n\t\t\tconst entry = config.entry as any;\n\t\t\tentry[mainEntry].push('@dojo/webpack-contrib/service-worker-plugin/service-worker-entry');\n\t\t}\n\t}\n\n\tif (args.watch !== 'memory' && args['build-time-render']) {\n\t\tconfig.plugins.push(\n\t\t\tnew BuildTimeRender({\n\t\t\t\t...args['build-time-render'],\n\t\t\t\tentries: args.singleBundle ? Object.keys(config.entry!) : ['runtime', ...Object.keys(config.entry!)],\n\t\t\t\tuseManifest: true\n\t\t\t})\n\t\t);\n\t}\n\n\tconfig.output = {\n\t\t...output,\n\t\tpath: outputPath\n\t};\n\n\tconfig.devtool = 'inline-source-map';\n\treturn config;\n}\n\nexport default webpackConfig;\n"]}