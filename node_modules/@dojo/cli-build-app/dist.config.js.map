{"version":3,"file":"dist.config.js","sourceRoot":"","sources":["../../../src/dist.config.ts"],"names":[],"mappings":"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","sourcesContent":["import BuildTimeRender from '@dojo/webpack-contrib/build-time-render/BuildTimeRender';\nimport BundleAnalyzerPlugin from '@dojo/webpack-contrib/webpack-bundle-analyzer/BundleAnalyzerPlugin';\nimport ServiceWorkerPlugin, {\n\tServiceWorkerOptions\n} from '@dojo/webpack-contrib/service-worker-plugin/ServiceWorkerPlugin';\nimport * as CleanWebpackPlugin from 'clean-webpack-plugin';\nimport * as CopyWebpackPlugin from 'copy-webpack-plugin';\nimport * as fs from 'fs';\nimport * as HtmlWebpackPlugin from 'html-webpack-plugin';\nimport * as MiniCssExtractPlugin from 'mini-css-extract-plugin';\nimport * as path from 'path';\nimport * as webpack from 'webpack';\nimport * as WebpackChunkHash from 'webpack-chunk-hash';\nimport * as ManifestPlugin from 'webpack-manifest-plugin';\nimport baseConfigFactory, { mainEntry, packageName } from './base.config';\nimport { WebAppManifest } from './interfaces';\n\nconst BrotliPlugin = require('brotli-webpack-plugin');\nconst CompressionPlugin = require('compression-webpack-plugin');\nconst OptimizeCssAssetsPlugin = require('optimize-css-assets-webpack-plugin');\nconst TerserPlugin = require('terser-webpack-plugin');\nconst WebpackPwaManifest = require('webpack-pwa-manifest');\n\nconst banner = `\n[Dojo](https://dojo.io/)\nCopyright [JS Foundation](https://js.foundation/) & contributors\n[New BSD license](https://github.com/dojo/meta/blob/master/LICENSE)\nAll rights reserved\n`;\n\nfunction webpackConfig(args: any): webpack.Configuration {\n\tconst config = baseConfigFactory(args);\n\tconst manifest: WebAppManifest = args.pwa && args.pwa.manifest;\n\tconst serviceWorker: ServiceWorkerOptions = args.pwa && args.pwa.serviceWorker;\n\tconst { plugins, output } = config;\n\tconst outputPath = path.join(output!.path!, 'dist');\n\tconst assetsDir = path.join(process.cwd(), 'assets');\n\tconst assetsDirExists = fs.existsSync(assetsDir);\n\n\tconfig.mode = 'production';\n\n\tconfig.optimization = {\n\t\t...config.optimization,\n\t\tminimizer: [\n\t\t\tnew TerserPlugin({ sourceMap: true, cache: true }),\n\t\t\tnew OptimizeCssAssetsPlugin({\n\t\t\t\tcssProcessor: require('cssnano'),\n\t\t\t\tcssProcessorPluginOptions: {\n\t\t\t\t\tpreset: ['default', { calc: false }]\n\t\t\t\t}\n\t\t\t})\n\t\t]\n\t};\n\n\tif (!args.singleBundle) {\n\t\tconfig.optimization.runtimeChunk = {\n\t\t\tname: 'runtime'\n\t\t};\n\t}\n\n\tconfig.plugins = [\n\t\t...plugins!,\n\t\tassetsDirExists && new CopyWebpackPlugin([{ from: assetsDir, to: path.join(outputPath, 'assets') }]),\n\t\tnew ManifestPlugin(),\n\t\tnew BundleAnalyzerPlugin({\n\t\t\tanalyzerMode: 'static',\n\t\t\topenAnalyzer: false,\n\t\t\tgenerateStatsFile: true,\n\t\t\treportFilename: '../info/report.html',\n\t\t\tstatsFilename: '../info/stats.json'\n\t\t}),\n\t\tnew HtmlWebpackPlugin({\n\t\t\tinject: true,\n\t\t\tchunks: args.singleBundle ? ['main'] : ['runtime', 'main'],\n\t\t\tmeta: manifest ? { 'mobile-web-app-capable': 'yes' } : {},\n\t\t\ttemplate: 'src/index.html'\n\t\t}),\n\t\tmanifest &&\n\t\t\tnew WebpackPwaManifest({\n\t\t\t\t...manifest,\n\t\t\t\tios: true,\n\t\t\t\ticons: Array.isArray(manifest.icons)\n\t\t\t\t\t? manifest.icons.map((icon) => ({ ...icon, ios: true }))\n\t\t\t\t\t: manifest.icons\n\t\t\t}),\n\t\tnew webpack.BannerPlugin(banner),\n\t\tnew WebpackChunkHash(),\n\t\tnew CleanWebpackPlugin(['dist'], { root: output!.path, verbose: false })\n\t].filter((item) => item);\n\n\tif (serviceWorker) {\n\t\tconst serviceWorkerOptions =\n\t\t\ttypeof serviceWorker === 'string' ? serviceWorker : { cachePrefix: packageName, ...serviceWorker };\n\t\tconfig.plugins.push(new ServiceWorkerPlugin(serviceWorkerOptions));\n\n\t\tif (typeof serviceWorker !== 'string') {\n\t\t\tconst entry = config.entry as any;\n\t\t\tentry[mainEntry].push('@dojo/webpack-contrib/service-worker-plugin/service-worker-entry');\n\t\t}\n\t}\n\n\tif (args.watch !== 'memory' && args['build-time-render']) {\n\t\tconfig.plugins.push(\n\t\t\tnew BuildTimeRender({\n\t\t\t\t...args['build-time-render'],\n\t\t\t\tentries: args.singleBundle ? Object.keys(config.entry!) : ['runtime', ...Object.keys(config.entry!)],\n\t\t\t\tuseManifest: true\n\t\t\t})\n\t\t);\n\t}\n\n\tconfig.plugins = config.plugins.map((plugin) => {\n\t\tif (plugin instanceof MiniCssExtractPlugin) {\n\t\t\treturn new MiniCssExtractPlugin({\n\t\t\t\tfilename: '[name].[contenthash].bundle.css'\n\t\t\t});\n\t\t}\n\t\treturn plugin;\n\t});\n\n\tif (Array.isArray(args.compression)) {\n\t\tconst compressionPlugins: any = {\n\t\t\tgzip: CompressionPlugin,\n\t\t\tbrotli: BrotliPlugin\n\t\t};\n\t\targs.compression.forEach((algorithm: 'brotli' | 'gzip') => {\n\t\t\tconst options = { algorithm, test: /\\.(js|css|html|svg)$/ };\n\t\t\tconst Plugin = compressionPlugins[algorithm];\n\t\t\tconfig.plugins!.push(new Plugin(options));\n\t\t});\n\t}\n\n\tconfig.output = {\n\t\t...output,\n\t\tpath: outputPath,\n\t\tchunkFilename: '[name].[chunkhash].bundle.js',\n\t\tfilename: '[name].[chunkhash].bundle.js'\n\t};\n\n\treturn config;\n}\n\nexport default webpackConfig;\n"]}