{"version":3,"file":"main.js","sourceRoot":"","sources":["main.ts"],"names":[],"mappings":"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","sourcesContent":["import { Command, EjectOutput, Helper, OptionsHelper } from '@dojo/cli/interfaces';\nimport * as express from 'express';\nimport * as logUpdate from 'log-update';\nimport * as ora from 'ora';\nimport * as path from 'path';\nimport * as url from 'url';\nimport * as webpack from 'webpack';\nimport chalk from 'chalk';\nimport * as fs from 'fs';\nimport * as https from 'https';\nimport * as proxy from 'http-proxy-middleware';\nimport * as history from 'connect-history-api-fallback';\n\nconst pkgDir = require('pkg-dir');\nconst expressStaticGzip = require('express-static-gzip');\nimport devConfigFactory from './dev.config';\nimport unitConfigFactory from './unit.config';\nimport functionalConfigFactory from './functional.config';\nimport distConfigFactory from './dist.config';\nimport logger from './logger';\nimport { moveBuildOptions } from './util/eject';\n\nconst fixMultipleWatchTrigger = require('webpack-mild-compile');\nconst hotMiddleware = require('webpack-hot-middleware');\nconst webpackMiddleware = require('webpack-dev-middleware');\n\nconst testModes = ['test', 'unit', 'functional'];\n\nfunction createCompiler(config: webpack.Configuration) {\n\tconst compiler = webpack(config);\n\tfixMultipleWatchTrigger(compiler);\n\treturn compiler;\n}\n\nfunction createWatchCompiler(config: webpack.Configuration) {\n\tconst compiler = createCompiler(config);\n\tconst spinner = ora('building').start();\n\tcompiler.hooks.invalid.tap('@dojo/cli-build-app', () => {\n\t\tlogUpdate('');\n\t\tspinner.start();\n\t});\n\tcompiler.hooks.done.tap('@dojo/cli-build-app', () => {\n\t\tspinner.stop();\n\t});\n\treturn compiler;\n}\n\nfunction build(config: webpack.Configuration, args: any) {\n\tconst compiler = createCompiler(config);\n\tconst spinner = ora('building').start();\n\treturn new Promise<void>((resolve, reject) => {\n\t\tcompiler.run((err, stats) => {\n\t\t\tspinner.stop();\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t\tif (stats) {\n\t\t\t\tconst runningMessage = args.serve ? `Listening on port ${args.port}...` : '';\n\t\t\t\tconst hasErrors = logger(stats.toJson({ warningsFilter }), config, runningMessage);\n\t\t\t\tif (hasErrors) {\n\t\t\t\t\treject({});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (args.mode === 'test') {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t'Using `--mode=test` is deprecated and has only built the unit test bundle. This mode will be removed in the next major release, please use `unit` or `functional` explicitly instead.'\n\t\t\t\t);\n\t\t\t}\n\t\t\tresolve(args.serve);\n\t\t});\n\t});\n}\n\nfunction buildNpmDependencies(): any {\n\ttry {\n\t\tconst packagePath = pkgDir.sync(__dirname);\n\t\tconst packageJsonFilePath = path.join(packagePath, 'package.json');\n\t\tconst packageJson = require(packageJsonFilePath);\n\n\t\treturn {\n\t\t\t[packageJson.name]: packageJson.version,\n\t\t\t...packageJson.dependencies\n\t\t};\n\t} catch (e) {\n\t\tthrow new Error(`Failed reading dependencies from package.json - ${e.message}`);\n\t}\n}\n\nfunction fileWatch(config: webpack.Configuration, args: any): Promise<void> {\n\tconst compiler = createWatchCompiler(config);\n\n\treturn new Promise<void>((resolve, reject) => {\n\t\tconst watchOptions = config.watchOptions as webpack.Compiler.WatchOptions;\n\t\tcompiler.watch(watchOptions, (err, stats) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t\tif (stats) {\n\t\t\t\tconst runningMessage = args.serve ? `Listening on port ${args.port}` : 'watching...';\n\t\t\t\tlogger(stats.toJson({ warningsFilter }), config, runningMessage);\n\t\t\t}\n\t\t\tresolve();\n\t\t});\n\t});\n}\n\nfunction memoryWatch(config: webpack.Configuration, args: any, app: express.Application): Promise<void> {\n\tconst entry = config.entry as any;\n\tconst plugins = config.plugins as webpack.Plugin[];\n\tconst timeout = 20 * 1000;\n\n\tplugins.push(new webpack.HotModuleReplacementPlugin(), new webpack.NoEmitOnErrorsPlugin());\n\tObject.keys(entry).forEach((name) => {\n\t\tentry[name].unshift(`webpack-hot-middleware/client?timeout=${timeout}&reload=true`);\n\t\tentry[name].unshift('eventsource-polyfill');\n\t});\n\n\tconst watchOptions = config.watchOptions as webpack.Compiler.WatchOptions;\n\tconst compiler = createWatchCompiler(config);\n\n\tcompiler.hooks.done.tap('@dojo/cli-build-app', (stats) => {\n\t\tlogger(stats.toJson({ warningsFilter }), config, `Listening on port ${args.port}...`);\n\t});\n\n\tapp.use(\n\t\twebpackMiddleware(compiler, {\n\t\t\tlogLevel: 'silent',\n\t\t\tnoInfo: true,\n\t\t\tpublicPath: '/',\n\t\t\twatchOptions\n\t\t}),\n\t\thotMiddleware(compiler, {\n\t\t\theartbeat: timeout / 2\n\t\t})\n\t);\n\n\treturn Promise.resolve();\n}\n\nfunction serve(config: webpack.Configuration, args: any): Promise<void> {\n\tlet isHttps = false;\n\n\tconst app = express();\n\n\tapp.use(\n\t\thistory({\n\t\t\trewrites: [\n\t\t\t\t{\n\t\t\t\t\tfrom: /^.*\\.(?!html).*$/,\n\t\t\t\t\tto: (context: any) => {\n\t\t\t\t\t\tconst { host, referer } = context.request.headers;\n\t\t\t\t\t\tconst { url: originalUrl } = context.request;\n\t\t\t\t\t\tif (!referer || referer.endsWith(host + originalUrl)) {\n\t\t\t\t\t\t\treturn originalUrl;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst parsedUrl = url.parse(referer);\n\t\t\t\t\t\tconst pathnames = parsedUrl && parsedUrl.pathname ? parsedUrl.pathname.split('/') : [];\n\t\t\t\t\t\tconst urlRewrite = pathnames.reduce((rewrite, segment) => {\n\t\t\t\t\t\t\tif (!segment) {\n\t\t\t\t\t\t\t\treturn rewrite;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn rewrite.replace(`/${segment}`, '');\n\t\t\t\t\t\t}, context.parsedUrl.pathname);\n\t\t\t\t\t\treturn urlRewrite;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t})\n\t);\n\n\tif (args.watch !== 'memory') {\n\t\tconst outputDir = (config.output && config.output.path) || process.cwd();\n\t\tif (args.mode === 'dist' && Array.isArray(args.compression)) {\n\t\t\tconst useBrotli = args.compression.includes('brotli');\n\t\t\tapp.use(\n\t\t\t\texpressStaticGzip(outputDir, {\n\t\t\t\t\tenableBrotli: useBrotli,\n\t\t\t\t\torderPreference: useBrotli ? ['br'] : undefined\n\t\t\t\t})\n\t\t\t);\n\t\t} else {\n\t\t\tapp.use(express.static(outputDir));\n\t\t}\n\t}\n\n\tif (args.proxy) {\n\t\tObject.keys(args.proxy).forEach((context) => {\n\t\t\tconst options = args.proxy[context];\n\n\t\t\tif (typeof options === 'string') {\n\t\t\t\tapp.use(proxy(context, { target: options }));\n\t\t\t} else {\n\t\t\t\tapp.use(proxy(context, options));\n\t\t\t}\n\t\t});\n\t}\n\n\tconst defaultKey = path.resolve('.cert', 'server.key');\n\tconst defaultCrt = path.resolve('.cert', 'server.crt');\n\n\tif (fs.existsSync(defaultKey) && fs.existsSync(defaultCrt)) {\n\t\tisHttps = true;\n\t}\n\n\treturn Promise.resolve()\n\t\t.then(() => {\n\t\t\tif (args.watch === 'memory' && args.mode === 'dev') {\n\t\t\t\treturn memoryWatch(config, args, app);\n\t\t\t}\n\n\t\t\tif (args.watch) {\n\t\t\t\tif (args.watch === 'memory') {\n\t\t\t\t\tconsole.warn('Memory watch requires `--mode=dev`. Using file watch instead...');\n\t\t\t\t}\n\t\t\t\treturn fileWatch(config, args);\n\t\t\t}\n\n\t\t\treturn build(config, args);\n\t\t})\n\t\t.then(() => {\n\t\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\t\tif (isHttps) {\n\t\t\t\t\thttps\n\t\t\t\t\t\t.createServer(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tkey: fs.readFileSync(defaultKey),\n\t\t\t\t\t\t\t\tcert: fs.readFileSync(defaultCrt)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tapp\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.listen(args.port, (error: Error) => {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tapp.listen(args.port, (error: Error) => {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n}\n\nfunction warningsFilter(warning: string) {\n\treturn warning.includes('[mini-css-extract-plugin]\\nConflicting order between');\n}\n\nconst command: Command = {\n\tgroup: 'build',\n\tname: 'app',\n\tdescription: 'create a build of your application',\n\tregister(options: OptionsHelper) {\n\t\toptions('mode', {\n\t\t\tdescribe: 'the output mode',\n\t\t\talias: 'm',\n\t\t\tdefault: 'dist',\n\t\t\tchoices: ['dist', 'dev', 'test', 'unit', 'functional']\n\t\t});\n\n\t\toptions('watch', {\n\t\t\tdescribe: 'watch for file changes: \"memory\" (dev mode only) or \"file\" (all modes; default)',\n\t\t\talias: 'w'\n\t\t});\n\n\t\toptions('serve', {\n\t\t\tdescribe: 'start a webserver',\n\t\t\talias: 's',\n\t\t\ttype: 'boolean'\n\t\t});\n\n\t\toptions('port', {\n\t\t\tdescribe: 'used in conjunction with the serve option to specify the webserver port',\n\t\t\talias: 'p',\n\t\t\tdefault: 9999,\n\t\t\ttype: 'number'\n\t\t});\n\n\t\toptions('single-bundle', {\n\t\t\tdescribe: 'Limits the built output to single bundle',\n\t\t\tdefault: false,\n\t\t\ttype: 'boolean'\n\t\t});\n\n\t\toptions('legacy', {\n\t\t\tdescribe: 'build app with legacy browser support',\n\t\t\talias: 'l',\n\t\t\tdefault: false,\n\t\t\ttype: 'boolean'\n\t\t});\n\n\t\toptions('feature', {\n\t\t\tdescribe: 'List of features to include',\n\t\t\talias: 'f',\n\t\t\tarray: true,\n\t\t\tcoerce: (args: string[]) => {\n\t\t\t\treturn args.reduce(\n\t\t\t\t\t(newArgs, arg) => {\n\t\t\t\t\t\tconst parts = arg.split('=');\n\t\t\t\t\t\tif (parts.length === 1) {\n\t\t\t\t\t\t\tnewArgs[arg] = true;\n\t\t\t\t\t\t} else if (parts.length === 2) {\n\t\t\t\t\t\t\tnewArgs[parts[0]] = parts[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn newArgs;\n\t\t\t\t\t},\n\t\t\t\t\t{} as any\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t},\n\trun(helper: Helper, args: any) {\n\t\tconsole.log = () => {};\n\t\tlet config: webpack.Configuration;\n\t\tlet { feature, ...remainingArgs } = args;\n\t\tremainingArgs = { ...remainingArgs, features: { ...remainingArgs.features, ...feature } };\n\t\tif (args.mode === 'dev') {\n\t\t\tconfig = devConfigFactory(remainingArgs);\n\t\t} else if (args.mode === 'unit' || args.mode === 'test') {\n\t\t\tconfig = unitConfigFactory(remainingArgs);\n\t\t} else if (args.mode === 'functional') {\n\t\t\tconfig = functionalConfigFactory(remainingArgs);\n\t\t} else {\n\t\t\tconfig = distConfigFactory(remainingArgs);\n\t\t}\n\n\t\tif (args.serve) {\n\t\t\tif (testModes.indexOf(args.mode) !== -1) {\n\t\t\t\treturn Promise.reject(new Error(`Cannot use \\`--serve\\` with \\`--mode=${args.mode}\\``));\n\t\t\t}\n\t\t\treturn serve(config, args);\n\t\t}\n\n\t\tif (args.watch) {\n\t\t\tif (args.watch === 'memory') {\n\t\t\t\tconsole.warn('Memory watch requires the dev server. Using file watch instead...');\n\t\t\t}\n\t\t\treturn fileWatch(config, args);\n\t\t}\n\n\t\treturn build(config, args);\n\t},\n\teject(helper: Helper): EjectOutput {\n\t\treturn {\n\t\t\tcopy: {\n\t\t\t\tpath: __dirname,\n\t\t\t\tfiles: [\n\t\t\t\t\tmoveBuildOptions(`${this.group}-${this.name}`),\n\t\t\t\t\t'./base.config.js',\n\t\t\t\t\t'./base.test.config.js',\n\t\t\t\t\t'./dev.config.js',\n\t\t\t\t\t'./dist.config.js',\n\t\t\t\t\t'./ejected.config.js',\n\t\t\t\t\t'./unit.config.js',\n\t\t\t\t\t'./functional.config.js'\n\t\t\t\t]\n\t\t\t},\n\t\t\thints: [\n\t\t\t\t`to build run ${chalk.underline(\n\t\t\t\t\t'./node_modules/.bin/webpack --config ./config/build-app/ejected.config.js --env.mode={dev|dist|unit|functional}'\n\t\t\t\t)}`\n\t\t\t],\n\t\t\tnpm: {\n\t\t\t\tdevDependencies: { ...buildNpmDependencies() }\n\t\t\t}\n\t\t};\n\t}\n};\nexport default command;\n"]}